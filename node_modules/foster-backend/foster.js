/**
 * Spotivity App Start Script
 */
const config = require("./lib/config");
const logger = require("./lib/logger").logger;





config.dbConfig.connectDb(config.env, (err) => {
  if (err) {
    logger.error("err = ", err);
    return;
  }
  config.dbConfig.connectRedis(config.env, (errror, res) => {
    if (errror) {
      return;
    }
    // load external modules
    const express = require("express");

    // init express app
    const app = express();

    // set server home directory
    app.locals.rootDir = __dirname;

    // config express
    config.expressConfig(app, config.env.environment);

    // attach the routes to the app
    require("./lib/routes")(app);

    // start server
    const server = app.listen(config.env.port, () => {
      console.log(`Express server listening on ${config.env.port}, in ${config.env.TAG} mode`);
    });
  });
});
