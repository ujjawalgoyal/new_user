const appUtil = require("../appUtils");
const exceptions = require("../customExceptions");
const appHttpClient = require("../appHttpClient");

// const FB_PROFILE_FETCH_URL = "https://graph.facebook.com/me?fields=email,first_name,id,last_name,name,gender,birthday,picture{url}&access_token=";
const FB_PROFILE_FETCH_URL = "https://graph.facebook.com/me?fields=email,id&access_token=";
const GOOGLE_PLUS_PROFILE_FETCH_URL = "https://www.googleapis.com/plus/v1/people/me?access_token=";

module.exports = {
  /**
     * [getFBProfile description]
     * @param  {[type]}   token    [description]
     * @param  {Function} callback(fbUser) - fbUser is jsonObject with fields
     * first_name, last_name, id, email, gender;
     * @return {[type]}            [description]
     */
  getFBProfile(token) {
    return appHttpClient.getSecure(FB_PROFILE_FETCH_URL + token)
      .then((resp) => {
        const retVal = JSON.parse(resp);
        if (retVal.error) {
          const exception = exceptions.getIncorrectFbTokenException();
          exception.error = retVal;
          throw exception;
        }
        console.log("facebook response", retVal)
        return retVal;
      });
  },

  /**
     * [getInstaProfile description]
     * @param  {[type]}   token    [description]
     * @param  {Function} callback(instaUser) - fbUser is jsonObject with fields
     * first_name, last_name, id, email, gender;
     * @return {[type]}            [description]
     */
  getInstaProfile(token) {
    return appHttpClient.getSecure(INSTA_PROFILE_FETCH_URL + token)
      .then((resp) => {
        const retVal = JSON.parse(resp);
        if (retVal.meta.code !== 200) {
          const exception = exceptions.getIncorrectInstaTokenException();
          exception.error = retVal;
          throw exception;
        }
        return retVal;
      });
  },

  /**
   * [getGooglePlusProfile description]
   * @param  {[type]}   token    [description]
   * @param  {Function} callback(gplusUser) - gplusUser is jsonObject with fields
   * first_name, last_name, id, email, gender;
   * @return {[type]}            [description]
   */
  getGooglePlusProfile(token) {
    return appHttpClient.getSecure(GOOGLE_PLUS_PROFILE_FETCH_URL + token)
      .then((resp) => {
        const retVal = JSON.parse(resp);
        if (retVal.error) {
          const exception = exceptions.getIncorrectGoogleTokenException();
          exception.error = retVal;
          throw exception;
        }
        return retVal;
      });
  }

};
