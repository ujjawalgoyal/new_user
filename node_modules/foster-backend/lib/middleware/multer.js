

//= ========================= Load Modules Start ===========================

//= ========================= Load External Module =========================

const multer = require("multer");

//= ========================= Load Internal Module =========================


//= ========================= Load Modules End =============================

//= ========================= Export Module Start ===========================

// define disk storage strategy for multer
const storage = multer.diskStorage({
  destination(req, file, callback) {
    callback(null, "./upload");
  },
  filename(req, file, callback) {
    callback(null, `${file.fieldname}_${Date.now()}_${file.originalname.replace(/\s/g,'')}`);
  },
});

const upload = multer({ storage });

const singleFile = function (key) {
  if (key) {
    return upload.single(key);
  }
};

const multiFile = function (key, fileCnt) {
  return upload.array(key, fileCnt);
};

/**
 * upload files under different keys and different count
 * field array is like
 * [{ name: 'avatar', maxCount: 1 }, { name: 'gallery', maxCount: 8 }]
 * @param fieldsArray
 * @private
 */
const multiFields = function (fieldsArray) {
  return upload.fields(fieldsArray);
};

module.exports = {
  singleFile,
  multiFile,
  multiFields,
};
